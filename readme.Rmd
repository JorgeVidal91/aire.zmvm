---
title: "Mexico City Pollution Data"
author: "Diego Valle-Jones"
date: "March 18, 2016"
output: 
 github_document:
          toc: true
          fig_width: 8
          fig_height: 5
---

Master: [![Travis-CI Build Status](https://travis-ci.org/diegovalle/aire.zmvm.svg?branch=master)](https://travis-ci.org/diegovalle/aire.zmvm) 

|              |          |
|--------------|---------------|
| __Author:__ | Diego Valle-Jones |
| __License:__ | [BSD_3](https://opensource.org/licenses/BSD-3-Clause) |
| __Status:__ | alpha |
| __Website:__ | [https://github.com/diegovalle/aire.zmvm](https://github.com/diegovalle/aire.zmvm) |


## What does it do?

This package downloads pollution data for the Mexico City metro area. It can download the daily maximum, minimum, or average for each of the pollution measuring stations in the Zona Metropolitana del Valle de Mexico


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Installation

For the moment this package is only available from github. For the development version:

```r
if (!require(devtools)) {
    install.packages("devtools")
}
devtools::install_github('diegovalle/aire.zmvm')
```

## Quick Example

The package consists mainly of two functions: 

* ```get_zone_data``` to download data for each of the 5 geographic zones of Mexico City 
* ```get_station_data``` to download data for each of the pollution (and wind and temperature) measuring stations.

```{r, fig.show='hold',  message=FALSE}
library("aire.zmvm")
library("dplyr")
library("ggplot2")

# Download pm10 data since 2008 for all available zones ("TZ")
pm_10 <- get_zone_data(criterion = "MAXIMOS", # Can be MAXIMOS (daily maximum) or HORARIOS (hourly average)
                       pollutant = "PM10", # "SO2", "CO", "NO2", "O3", "PM10", "TC" (All pollutants)
                       zone = "TZ", # "NO", "NE", "CE", "SO", "SE", "TZ" (All zones)
                       start_date = "2008-01-01", # Can't be earlier than 2008-01-01
                       end_date = "2016-03-19") # Can be up to the current date
knitr::kable(head(pm_10))

# Plot the overall highest maximum pm10 level with trendline
ggplot(pm_10 %>% group_by(date) %>% summarise(max = max(value, na.rm = TRUE)), 
       aes(date, max, group = 1)) +
  geom_line(color = "darkgray", size = .2) +
  geom_smooth(method = "gam", formula = y ~ s(x, k = 50), se = FALSE) +
  theme_bw()
```
