---
title: "Introduction to the aire.zmvm package"
author: "Diego Valle-Jones"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

get_zone_data

```{r, fig.show='hold',  message=FALSE}
library("aire.zmvm")
library("dplyr")
library("ggplot2")

# Download pm10 data since 2008 for all available zones ("TZ")
pm_10 <- get_zone_data(criterion = "MAXIMOS", # Can be MAXIMOS (daily maximum) or HORARIOS (hourly average)
                       pollutant = "PM10", # "SO2", "CO", "NO2", "O3", "PM10", "TC" (All pollutants)
                       zone = "TZ", # "NO", "NE", "CE", "SO", "SE", "TZ" (All zones)
                       start_date = "2008-01-01", # Can't be earlier than 2008-01-01
                       end_date = "2016-03-19") # Can be up to the current date
knitr::kable(head(pm_10))

# Plot the overall highest maximum pm10 level with trendline
ggplot(pm_10 %>% group_by(date) %>% summarise(max = max(value, na.rm = TRUE)), 
       aes(date, max, group = 1)) +
  geom_line(color = "darkgray", size = .2) +
  geom_smooth(method = "gam", formula = y ~ s(x, k = 50), se = FALSE) +
  ggtitle("Daily maximum PM10 levels in IMECAS") +
  theme_bw()

```

get_station_data

```{r, fig.show='hold',  message=FALSE}
o3 <- get_station_data(criterion = "MAXIMOS", # Can be MAXIMOS (daily maximum), MINIMOS (daily minimum), or HORARIOS (hourly average)
                       pollutant = "O3", # "so2", "co", "nox", "no2",
                             # "no", "o3", "pm10", "pm2",
                             # "wsp", "wdr", "tmp", "rh"
                       year = 2008:2016) # The earliest available year is 2005 

knitr::kable(head(o3))

# Plot the overall highest maximum ozone level with trendline
ggplot(o3 %>% group_by(date) %>% summarise(max = max(value, na.rm = TRUE)), 
       aes(date, max, group = 1)) +
  geom_line(color = "darkgray", size = .2) +
  geom_smooth(method = "gam", formula = y ~ s(x, k = 10), se = FALSE) +
  ggtitle("Daily maximum ozone levels in ppb") +
  theme_bw()
```

```{r}
library("seasonal")
library("lubridate")


pm_10 <- get_zone_data("MAXIMOS", "PM10", "TZ", "2008-01-01", "2016-03-19")
pm10_m <- pm_10 %>%
  group_by(month(date), year(date)) %>%
  summarise(max = median(value, na.rm = TRUE))

# Monthly median of maximums
pm10_m <- pm_10 %>%
  group_by(date) %>%
  summarise(max = max(value, na.rm = TRUE)) %>%
  ungroup() %>%
  group_by(month(date), year(date)) %>%
  summarise(max = max(max))


pm10_ts <- ts(pm10_m$max, start = 2008, freq = 12)

# #Seasonally adjusted (by trading day and easter holiday)
m <- seas(pm10_ts,
          regression.variables = c("td1coef", "easter[1]"))
plot(m) 
```

available stations

```{r}
data("stations")
knitr::kable(head(stations))
```
